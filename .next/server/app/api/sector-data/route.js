"use strict";(()=>{var e={};e.id=375,e.ids=[375],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},13992:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>P,originalPathname:()=>b,patchFetch:()=>h,requestAsyncStorage:()=>g,routeModule:()=>v,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>y});var r={};a.r(r),a.d(r,{POST:()=>c});var i=a(95419),n=a(69108),o=a(99678),s=a(78070),u=a(81355),l=a(3205),d=a(3214);async function c(e){try{let t=await (0,u.getServerSession)(l.L);if(!t)return s.Z.json({message:"Unauthorized"},{status:401});let{department:a,data:r,date:i}=await e.json();if(t.user.department!==a)return s.Z.json({message:"Forbidden: You can only submit data for your department"},{status:403});let n=await p(a,r,t.user.id,i);return s.Z.json({message:"Data saved successfully",indicators:n,count:n.length},{status:201})}catch(e){return console.error("Error saving sector data:",e),s.Z.json({message:"Internal server error"},{status:500})}}async function p(e,t,a,r){let i=[];switch(e){case"COMERCIAL":i.push(await m({name:"Faturamento Dia",value:t.faturamentoDia,target:t.metaFaturamentoDia,unit:"BRL",description:"Faturamento do dia atual",userId:a,department:e,date:r}),await m({name:"Faturamento M\xeas Acumulado",value:t.faturamentoMesAcumulado,target:t.metaFaturamentoMes,unit:"BRL",description:"Faturamento acumulado do m\xeas",userId:a,department:e,date:r}),await m({name:"Positiva\xe7\xe3o Dia",value:t.positivacaoDia,target:t.metaPositivacaoDia,unit:"UNITS",description:"Positiva\xe7\xe3o do dia atual",userId:a,department:e,date:r}),await m({name:"Positiva\xe7\xe3o M\xeas Acumulado",value:t.positivacaoMesAcumulado,target:t.metaPositivacaoMes,unit:"UNITS",description:"Positiva\xe7\xe3o acumulada do m\xeas",userId:a,department:e,date:r}));break;case"LOGISTICA":i.push(await m({name:"OTIF M\xeas",value:t.otifMes,target:t.metaOtif,unit:"PERCENTAGE",description:"On Time In Full - dados D-2",userId:a,department:e,date:r}),await m({name:"Taxa Devolu\xe7\xe3o M\xeas",value:t.taxaDevolucaoMes,target:t.metaTaxaDevolucao,unit:"PERCENTAGE",description:"Taxa de devolu\xe7\xe3o - dados D-1",userId:a,department:e,date:r}),await m({name:"Custo Log\xedstico M\xeas",value:t.custoLogisticoMes,target:t.metaCustoLogistico,unit:"PERCENTAGE",description:"Custo log\xedstico - dados D-2",userId:a,department:e,date:r}));break;case"COMPRAS":i.push(await m({name:"Ruptura M\xeas Valor",value:t.rupturaMesValor,target:t.metaRupturaValor,unit:"BRL",description:"Valor de ruptura do m\xeas",userId:a,department:e,date:r}),await m({name:"Ruptura M\xeas Percentual",value:t.rupturaMesPercentual,target:t.metaRupturaPercentual,unit:"PERCENTAGE",description:"Percentual de ruptura do m\xeas",userId:a,department:e,date:r}),await m({name:"Cobertura Estoque",value:t.coberturaEstoqueValor,target:t.metaCoberturaEstoque,unit:"BRL",description:"Valor da cobertura de estoque",userId:a,department:e,date:r}),await m({name:"Curva C Valor",value:t.curvaCValor,target:t.metaCurvaCValor,unit:"BRL",description:"Valor da curva C",userId:a,department:e,date:r}),await m({name:"Curva C Percentual",value:t.curvaCPercentual,target:t.metaCurvaCPercentual,unit:"PERCENTAGE",description:"Percentual da curva C",userId:a,department:e,date:r}));break;case"FINANCEIRO":i.push(await m({name:"Inadimpl\xeancia 45d Valor",value:t.inadimplencia45dValor,target:t.metaInadimplenciaValor,unit:"BRL",description:"Valor de inadimpl\xeancia 45 dias",userId:a,department:e,date:r}),await m({name:"Inadimpl\xeancia 45d Percentual",value:t.inadimplencia45dPercentual,target:t.metaInadimplenciaPercentual,unit:"PERCENTAGE",description:"Percentual de inadimpl\xeancia 45 dias",userId:a,department:e,date:r}),await m({name:"Limites Implantados",value:t.limitesImplantadosValor,target:t.limitesImplantadosValor,unit:"BRL",description:"Limites de cr\xe9dito implantados M-1",userId:a,department:e,date:r}),await m({name:"Utiliza\xe7\xe3o Semanal",value:t.limitesUtilizadoSemanal,target:.8*t.limitesImplantadosValor,unit:"BRL",description:"Utiliza\xe7\xe3o semanal dos limites",userId:a,department:e,date:r}));break;default:throw Error(`Department ${e} not supported`)}return i.filter(Boolean)}async function m(e){try{let t=new Date().toISOString().split("T")[0],a=await d._.indicator.findFirst({where:{name:e.name,userId:e.userId,department:e.department,createdAt:{gte:new Date(t+"T00:00:00.000Z"),lt:new Date(t+"T23:59:59.999Z")}}});if(a)return await d._.indicator.update({where:{id:a.id},data:{value:e.value,target:e.target,unit:e.unit,description:e.description,updatedAt:new Date}});return await d._.indicator.create({data:{name:e.name,value:e.value,target:e.target,unit:e.unit,description:e.description,userId:e.userId,department:e.department}})}catch(e){return console.error("Error creating/updating indicator:",e),null}}let v=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/sector-data/route",pathname:"/api/sector-data",filename:"route",bundlePath:"app/api/sector-data/route"},resolvedPagePath:"C:\\Users\\suporteEsplendor50\\CascadeProjects\\esplendor_indicadores\\app\\api\\sector-data\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:w,headerHooks:P,staticGenerationBailout:y}=v,b="/api/sector-data/route";function h(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}},3205:(e,t,a)=>{a.d(t,{L:()=>u});var r=a(86485),i=a(54896),n=a(3214),o=a(6521),s=a.n(o);let u={adapter:(0,i.N)(n._),providers:[(0,r.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await n._.user.findUnique({where:{email:e.email}});return t&&t.isActive&&await s().compare(e.password,t.password)?{id:t.id,email:t.email,name:t.name,department:t.department,role:t.role}:null}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.department=t.department,e.role=t.role),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.sub,e.user.department=t.department,e.user.role=t.role),e)},pages:{signIn:"/auth/signin",signUp:"/auth/signup"}}},3214:(e,t,a)=>{a.d(t,{_:()=>i});var r=a(53524);let i=globalThis.prisma??new r.PrismaClient},77381:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},81355:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});var r={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n.default}});var i=a(77381);Object.keys(i).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(r,e))&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))});var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=o(t);if(a&&a.has(e))return a.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&({}).hasOwnProperty.call(e,n)){var s=i?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}return r.default=e,a&&a.set(e,r),r}(a(49605));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(o=function(e){return e?a:t})(e)}Object.keys(n).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(r,e))&&(e in t&&t[e]===n[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}}))})}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[638,393,650,206],()=>a(13992));module.exports=r})();